<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Compras</title>
<style>
  body{ font-family:sans-serif; background:#0a0a0a; color:#00e5ff; padding:10px; }
  table{ width:100%; border-collapse:collapse; font-size:14px; }
  th, td{ border:1px solid #333; padding:8px; }
  .mini-input{ width:100%; background:#111; color:#fff; border:1px solid #444; margin-bottom:2px; padding:4px; }
  .btn-buy{ background:#ffea00; color:#000; border:none; padding:5px; cursor:pointer; width:100%; }
</style>
</head>
<body>
  <h2>ITENS PARA COMPRAR (AUTORIZADOS)</h2>
  <table>
    <thead>
      <tr>
        <th>Solicitante</th>
        <th>Item</th>
        <th>Dados do Fornecedor</th>
        <th>PreÃ§o Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  // CONFIGURAÃ‡ÃƒO FIREBASE (Mantenha as suas chaves aqui)
  const firebaseConfig = {  apiKey:"AIzaSyBPz4aSee-kQY5hwlyzEw_4Jv3gGKL9iHY",
  authDomain:"tmg-painel.firebaseapp.com",
  databaseURL:"https://tmg-painel-default-rtdb.firebaseio.com",
  projectId:"tmg-painel",
  storageBucket:"tmg-painel.firebasestorage.app",
  messagingSenderId:"877912378151",
  appId:"1:877912378151:web:88af3a4f8f551acd603702"
 };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  db.ref("purchaseRequests").on("value", snap => {
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";
    
    snap.forEach(child => {
      const r = child.val();
      const id = child.key;

      // FILTRO: SÃ³ mostra o que jÃ¡ foi autorizado pelo admin
      if(r.status === "authorized" || r.status === "purchased"){
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.requestedBy || r.member || "-"}</td>
          <td>${r.item}</td>
          <td>
            <input class="mini-input" placeholder="Nome" value="${r.supplier?.name || ""}" onblur="upd('${id}','supplier/name',this.value)">
            <input class="mini-input" placeholder="Contato" value="${r.supplier?.contact || ""}" onblur="upd('${id}','supplier/contact',this.value)">
            <input class="mini-input" placeholder="Link/URL" value="${r.supplier?.link || ""}" onblur="upd('${id}','supplier/link',this.value)">
          </td>
          <td>R$ <input type="number" class="mini-input" style="width:80px" value="${r.total || ""}" onblur="updNum('${id}','total',this.value)"></td>
          <td>
            ${r.status === "authorized" ? 
              `<button class="btn-buy" onclick="setStatus('${id}','purchased')">ðŸ›’ MARCAR COMPRADO</button>` : 
              `<button style="background:#64dd17" onclick="setStatus('${id}','received')">âœ… RECEBIDO</button>`}
          </td>
        `;
        tbody.appendChild(tr);
      }
    });
  });

  function upd(id, path, val){
    let parts = path.split('/');
    let obj = {};
    if(parts.length === 2) {
      obj[parts[0]] = {};
      obj[parts[0]][parts[1]] = val;
    } else { obj[path] = val; }
    db.ref("purchaseRequests/" + id).update(obj);
  }

  function updNum(id, k, v){ db.ref("purchaseRequests/" + id).update({ [k]: parseFloat(v) }); }
  function setStatus(id, st){ db.ref("purchaseRequests/" + id).update({ status: st }); }
</script>
</body>
</html>
