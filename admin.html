<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin – Cronograma Oficina</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#000;
    color:#0ff;
}
header{
    background:#ddd;
    padding:10px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
header img{height:40px}
.container{
    max-width:1200px;
    margin:30px auto;
    padding:20px;
    border:2px solid #0ff;
    border-radius:20px;
}
.tabs button{
    margin-right:10px;
    padding:10px 20px;
    border-radius:20px;
    border:none;
    cursor:pointer;
}
.tabs .active{background:#0f0;color:#000}
input,select{
    padding:10px;
    border-radius:10px;
    border:none;
    margin-right:10px;
}
button.green{
    background:#0f0;
    border:none;
    padding:10px 20px;
    border-radius:20px;
    cursor:pointer;
}
table{
    width:100%;
    margin-top:20px;
    border-collapse:collapse;
}
th,td{
    padding:10px;
    border-bottom:1px solid #033;
    text-align:left;
}
.badge{
    padding:5px 10px;
    border-radius:20px;
    background:#022;
}
.actions button{
    margin-right:5px;
}
.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    align-items:center;
    justify-content:center;
}
.modal-content{
    background:#000;
    padding:30px;
    border:2px solid #0ff;
    border-radius:20px;
}
</style>
</head>

<body>

<header>
    <img src="tmg.png" alt="TMG Racing">
    <strong>ADMIN</strong>
</header>

<div class="container">

    <div class="tabs">
        <button class="active" onclick="showTab('members')">Membros</button>
        <button onclick="showTab('tasks')">Tarefas</button>
        <button onclick="showTab('dates')">Datas importantes</button>
        <button onclick="resetAll()">Zerar tudo</button>
    </div>

    <!-- MEMBROS -->
    <div id="members">
        <h2>MEMBROS</h2>
        <input id="mName" placeholder="Nome">
        <input id="mRole" placeholder="Função (opcional)">
        <select id="mActive">
            <option value="true">Ativo</option>
            <option value="false">Inativo</option>
        </select>
        <button class="green" onclick="addMember()">Adicionar</button>

        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Função</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="memberList"></tbody>
        </table>
    </div>

    <!-- PLACEHOLDER DAS OUTRAS ABAS -->
    <div id="tasks" style="display:none"><h2>Tarefas</h2></div>
    <div id="dates" style="display:none"><h2>Datas importantes</h2></div>

</div>

<!-- MODAL QR -->
<div class="modal" id="qrModal">
    <div class="modal-content">
        <h3>QR Code do Membro</h3>
        <div id="qrBox"></div><br>
        <button onclick="closeQR()">Fechar</button>
    </div>
</div>

<script>
let members = JSON.parse(localStorage.getItem("members") || "[]");

/* ---------- TABS ---------- */
function showTab(tab){
    document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
    event.target.classList.add("active");
    ["members","tasks","dates"].forEach(id=>{
        document.getElementById(id).style.display = id===tab?"block":"none";
    });
}

/* ---------- MEMBROS ---------- */
function saveMembers(){
    localStorage.setItem("members", JSON.stringify(members));
}

function addMember(){
    const name = mName.value.trim();
    if(!name){ alert("Nome obrigatório"); return; }

    if(members.find(m=>m.name===name)){
        alert("Membro já existe");
        return;
    }

    members.push({
        id: Date.now(),
        name,
        role: mRole.value,
        active: mActive.value==="true"
    });

    mName.value="";
    mRole.value="";
    renderMembers();
}

function renderMembers(){
    memberList.innerHTML="";
    members.forEach(m=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${m.name}</td>
            <td>${m.role||"-"}</td>
            <td><span class="badge">${m.active?"Ativo":"Inativo"}</span></td>
            <td class="actions">
                <button onclick="showQR('${m.name}')">QR</button>
                <button onclick="toggleMember(${m.id})">Ativar/Desativar</button>
                <button onclick="removeMember(${m.id})">Apagar</button>
            </td>`;
        memberList.appendChild(tr);
    });
    saveMembers();
}

function toggleMember(id){
    const m=members.find(x=>x.id===id);
    m.active=!m.active;
    renderMembers();
}

function removeMember(id){
    if(!confirm("Apagar membro?")) return;
    members=members.filter(x=>x.id!==id);
    renderMembers();
}

/* ---------- QR ---------- */
function showQR(name){
    const url = `${location.origin}/cronograma_oficina/equipe?m=${encodeURIComponent(name)}`;
    qrBox.innerHTML="";
    new QRCode(qrBox,{text:url,width:200,height:200});
    qrModal.style.display="flex";
}
function closeQR(){ qrModal.style.display="none"; }

/* ---------- RESET ---------- */
function resetAll(){
    if(confirm("Zerar tudo?")){
        localStorage.clear();
        location.reload();
    }
}

renderMembers();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</body>
</html>
