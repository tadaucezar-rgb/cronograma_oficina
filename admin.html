<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin - TMG Painel</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Orbitron',Arial,sans-serif;
  background:radial-gradient(circle at top,#0a0a0a,#000);
  color:#00e5ff;
}
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 16px;
  background:linear-gradient(90deg,#bdbdbd,#e0e0e0,#bdbdbd);
  color:#000;
  font-weight:900;
}
header img{height:36px}
.wrap{max-width:1200px;margin:auto;padding:14px}
.card{
  background:rgba(0,0,0,.78);
  border-radius:18px;
  padding:16px;
  border:2px solid rgba(0,229,255,.22);
  box-shadow:0 0 26px rgba(0,229,255,.22);
  margin-bottom:14px;
}
h2{text-align:center;color:#ff3d00;margin-top:0}
button,input,select,textarea{
  font-family:'Orbitron';
}
button{
  padding:8px 14px;
  border-radius:14px;
  border:none;
  font-weight:900;
  cursor:pointer;
}
.btn{background:#00c853;color:#000}
.btn2{background:#2979ff;color:#000}
.btnDanger{background:#ff1744;color:#000}
.tabs{
  display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:12px;
}
.tab{
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
.tab.active{background:#00c853;color:#000}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08);
  color:#fff;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:.82rem;
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.15);
}
th{text-transform:uppercase;font-size:.7rem}
.muted{opacity:.7;font-size:.75rem}
.pinBox{max-width:420px;margin:60px auto}
</style>
</head>

<body>
<header>
  <img src="logo_tmg_clean.png">
  <div>Admin</div>
</header>

<!-- PIN -->
<div class="wrap pinBox" id="pinBox">
  <div class="card">
    <h2>PIN</h2>
    <input id="pin" type="password" placeholder="PIN">
    <button class="btn" style="width:100%;margin-top:10px" onclick="unlock()">Entrar</button>
    <div class="muted" style="margin-top:8px">PIN padrão: <b>1234</b></div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">

<!-- QR CODE -->
<div class="wrap">
  <div class="card" style="text-align:center">
    <h2>QR Code – Equipe</h2>
    <div class="muted">Escaneie para abrir a tela da equipe</div>
    <div id="qrcode" style="margin:16px auto"></div>
    <div class="muted">Link: <span id="qrLink"></span></div>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <div class="tabs">
      <button class="tab active" onclick="showTab('members',this)">Membros</button>
      <button class="tab" onclick="showTab('tasks',this)">Tarefas</button>
      <button class="tab" onclick="showTab('dates',this)">Datas</button>
      <button class="tab" onclick="showTab('danger',this)">Zerar tudo</button>
    </div>

    <div id="members">
      <h2>Membros</h2>
      <input id="mName" placeholder="Nome">
      <button class="btn" style="margin-top:10px" onclick="addMember()">Adicionar</button>
      <table><tbody id="tbMembers"></tbody></table>
    </div>

    <div id="tasks" style="display:none">
      <h2>Tarefas</h2>
      <input id="tTitle" placeholder="Título">
      <button class="btn" style="margin-top:10px" onclick="addTask()">Adicionar</button>
      <table><tbody id="tbTasks"></tbody></table>
    </div>

    <div id="dates" style="display:none">
      <h2>Datas importantes</h2>
      <input id="dTitle" placeholder="Título">
      <input id="dDate" type="date">
      <button class="btn" style="margin-top:10px" onclick="addDate()">Adicionar</button>
      <table><tbody id="tbDates"></tbody></table>
    </div>

    <div id="danger" style="display:none">
      <h2>Zerar tudo</h2>
      <input id="wipeText" placeholder="Digite ZERAR">
      <input id="wipePin" type="password" placeholder="PIN">
      <button class="btnDanger" style="margin-top:10px" onclick="wipe()">APAGAR TUDO</button>
    </div>
  </div>
</div>
</div>

<script>
const PIN="1234";
function unlock(){
  if(pin.value!==PIN){alert("PIN incorreto");return;}
  pinBox.style.display="none";
  app.style.display="block";
  gerarQR();
}

function showTab(id,btn){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  btn.classList.add("active");
  ["members","tasks","dates","danger"].forEach(x=>{
    document.getElementById(x).style.display = (x===id)?"block":"none";
  });
}

const firebaseConfig={
 apiKey:"AIzaSyBPz4aSee-kQY5hwlyzEw_4Jv3gGKL9iHY",
 databaseURL:"https://tmg-painel-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

db.ref("people").on("value",s=>{
  tbMembers.innerHTML="";
  Object.entries(s.val()||{}).forEach(([id,m])=>{
    tbMembers.innerHTML+=`<tr><td>${m.name}</td></tr>`;
  });
});

function addMember(){
  if(!mName.value) return;
  db.ref("people").push({name:mName.value});
  mName.value="";
}

db.ref("tasks").on("value",s=>{
  tbTasks.innerHTML="";
  Object.values(s.val()||{}).forEach(t=>{
    tbTasks.innerHTML+=`<tr><td>${t.title}</td></tr>`;
  });
});

function addTask(){
  if(!tTitle.value) return;
  db.ref("tasks").push({title:tTitle.value});
  tTitle.value="";
}

db.ref("dates").on("value",s=>{
  tbDates.innerHTML="";
  Object.values(s.val()||{}).forEach(d=>{
    tbDates.innerHTML+=`<tr><td>${d.title}</td><td>${new Date(d.when||0).toLocaleDateString()}</td></tr>`;
  });
});

function addDate(){
  if(!dTitle.value||!dDate.value) return;
  db.ref("dates").push({title:dTitle.value,when:new Date(dDate.value).getTime()});
  dTitle.value=""; dDate.value="";
}

function gerarQR(){
  const url = window.location.origin + window.location.pathname.replace("admin.html","equipe.html");
  qrLink.innerText=url;
  qrcode.innerHTML="";
  new QRCode(qrcode,{text:url,width:220,height:220,colorDark:"#00e5ff",colorLight:"#000"});
}

function wipe(){
  if(wipeText.value!=="ZERAR"||wipePin.value!==PIN){alert("Confirmação incorreta");return;}
  if(!confirm("Irreversível. Confirmar?")) return;
  db.ref().update({people:null,tasks:null,dates:null});
  alert("Tudo apagado");
}
</script>
</body>
</html>
