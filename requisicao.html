<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Requisição de Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js">
function refreshItemSuggestions(){
  db.ref("purchaseRequests").once("value").then(snap=>{
    const data = snap.val()||{};
    const set = new Set();
    Object.values(data).forEach(r=>{
      const it = (r.item||r.description||"").toString().trim();
      if(it) set.add(it);
    });
    const dl = document.getElementById("dlItems");
    if(dl) dl.innerHTML = Array.from(set).sort().map(v=>`<option value="${esc(v)}"></option>`).join("");
  });
}
window.addEventListener("load", refreshItemSuggestions);

</script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:'Orbitron',Arial,sans-serif;background:radial-gradient(circle at top,#0a0a0a,#000);color:#00e5ff;}
header{padding:14px;background:linear-gradient(90deg,#bdbdbd,#e0e0e0,#bdbdbd);color:#000;font-weight:900;text-align:center;}
.container{padding:14px;max-width:520px;margin:auto;}
.card{background:rgba(0,0,0,.78);border-radius:18px;padding:16px;border:2px solid rgba(0,229,255,.22);box-shadow:0 0 26px rgba(0,229,255,.22);}
h2{text-align:center;color:#ff3d00;margin-top:0;}
label{display:block;margin-top:12px;font-size:.85rem;}
input,select,textarea{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;font-family:'Orbitron',Arial,sans-serif;margin-top:4px;}
textarea{resize:vertical;}
button{margin-top:16px;width:100%;padding:14px;border-radius:16px;border:none;background:linear-gradient(90deg,#00c853,#64dd17);color:#000;font-weight:900;font-size:1rem;cursor:pointer;}
.status{margin-top:14px;font-size:.85rem;text-align:center;opacity:.85;}
</style>
</head>

<body>
<header>Requisição de Compras / Serviços</header>

<div class="container">
  <div class="card">
    <h2>Nova Requisição</h2>

    <label>Seu nome</label>
    <input id="member" placeholder="Ex: Davi">

    <label>Centro de custo</label>
    <select id="cost">
      <option value="">Selecione</option>
      <option>Stock Car</option>
      <option>Fórmula 4</option>
      <option>Endurance</option>
      <option>Oficina</option>
      <option>Geral</option>
      <option>Outros</option>
    </select>

    <label>Material ou serviço</label>
    <input id="item" placeholder="Ex: Usinagem suporte alumínio">

    <label>Quantidade</label>
    <input id="qty" type="number" min="0" step="any">

    <label>Unidade</label>
    <select id="unit">
      <option>un</option>
      <option>kg</option>
      <option>m</option>
      <option>m²</option>
      <option>l</option>
      <option>jogo</option>
      <option>serviço</option>
    </select>

    <label>Observação</label>
    <textarea id="obs" rows="3"></textarea>

    <button onclick="send()">Enviar requisição</button>
    <div class="status" id="status"></div>
  </div>
</div>

<script>
function esc(s){return String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
const firebaseConfig={
  apiKey:"AIzaSyBPz4aSee-kQY5hwlyzEw_4Jv3gGKL9iHY",
  authDomain:"tmg-painel.firebaseapp.com",
  databaseURL:"https://tmg-painel-default-rtdb.firebaseio.com",
  projectId:"tmg-painel",
  storageBucket:"tmg-painel.firebasestorage.app",
  messagingSenderId:"877912378151",
  appId:"1:877912378151:web:88af3a4f8f551acd603702"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// Prefill do membro via URL (?m=Nome ou ?u=Nome) — permite edição manual
try{
  const p=new URLSearchParams(location.search);
  const pre=p.get("m")||p.get("u");
  if(pre){ document.getElementById("member").value=pre; }
}catch(e){}

// Centro de custo: se "Outros", abre campo manual
const costEl=document.getElementById("cost");
const costOtherEl=document.getElementById("costOther");
function syncCostOther(){
  const isOther=(costEl.value==="Outros");
  costOtherEl.style.display=isOther?"block":"none";
  if(!isOther) costOtherEl.value="";
}
costEl.addEventListener("change", syncCostOther);
syncCostOther();

function send(){
  const member=document.getElementById("member").value.trim();
  const item=document.getElementById("item").value.trim();
  const qty=document.getElementById("qty").value;
  const costSel=document.getElementById("cost").value;
  const costOther=(document.getElementById("costOther")?.value||"").trim();
  const costFinal=(costSel==="Outros"?costOther:costSel);
  if(!member||!item||!qty||!costFinal){
    document.getElementById("status").innerText="Preencha os campos obrigatórios.";
    return;
  }
  const data={
    member,
    cost:(document.getElementById("cost").value==="Outros" ? document.getElementById("costOther").value.trim() : document.getElementById("cost").value),
    item,
    qty:Number(qty),
    unit:document.getElementById("unit").value,
    obs:document.getElementById("obs").value.trim(),
    requestedAt:Date.now(),
    status:"requested"
  };
  db.ref("purchaseRequests").push(data).then(()=>{
    document.getElementById("status").innerText="Requisição enviada com sucesso ✔️";
    document.querySelectorAll("input,textarea").forEach(e=>e.value="");
    costEl.value=""; syncCostOther();
  });
}
</script>
</body>
</html>
