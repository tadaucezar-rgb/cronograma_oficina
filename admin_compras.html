<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin - Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:'Orbitron',Arial,sans-serif;background:radial-gradient(circle at top,#0a0a0a,#000);color:#00e5ff;}
header{padding:14px;background:linear-gradient(90deg,#bdbdbd,#e0e0e0,#bdbdbd);color:#000;font-weight:900;text-align:center;}
.container{padding:14px;max-width:900px;margin:auto;}
.card{background:rgba(0,0,0,.78);border-radius:18px;padding:16px;border:2px solid rgba(0,229,255,.22);box-shadow:0 0 26px rgba(0,229,255,.22);margin-bottom:12px;}
h2{margin-top:0;color:#ff3d00;text-align:center;}
table{width:100%;border-collapse:collapse;font-size:.85rem;}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.15);text-align:left;}
button{padding:8px 12px;border-radius:12px;border:none;font-family:'Orbitron',Arial,sans-serif;font-weight:900;cursor:pointer;}
.btn-ok{background:linear-gradient(90deg,#00c853,#64dd17);color:#000;}
.btn-no{background:linear-gradient(90deg,#b71c1c,#ff1744);color:#fff;}
input{padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;font-family:'Orbitron';}
.pin{max-width:300px;margin:60px auto;}
</style>
</head>

<body>

<header>Administração de Compras</header>

<div class="container" id="login">
  <div class="card pin">
    <h2>PIN de acesso</h2>
    <input id="pin" type="password" placeholder="Digite o PIN">
    <button class="btn-ok" onclick="checkPin()">Entrar</button>
  </div>
</div>

<div class="container" id="content" style="display:none;">
  <div class="card">
    <div class="filters" id="tabs">
      <button class="fbtn active" data-tab="pendentes">Pendentes</button>
      <button class="fbtn" data-tab="acomp">Acompanhamento</button>
    </div>
    <h2 id="hPend">Requisições Pendentes</h2>
    <table id="tablePend">
      <thead>
        <tr>
          <th>Data</th>
          <th>Membro</th>
          <th>Centro de custo</th>
          <th>Item</th>
          <th>Qtd</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>
function esc(s){return String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
const ADMIN_PIN="1234"; // <<< ALTERE AQUI

const firebaseConfig={
  apiKey:"AIzaSyBPz4aSee-kQY5hwlyzEw_4Jv3gGKL9iHY",
  authDomain:"tmg-painel.firebaseapp.com",
  databaseURL:"https://tmg-painel-default-rtdb.firebaseio.com",
  projectId:"tmg-painel",
  storageBucket:"tmg-painel.firebasestorage.app",
  messagingSenderId:"877912378151",
  appId:"1:877912378151:web:88af3a4f8f551acd603702"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

function checkPin(){
  if(document.getElementById("pin").value===ADMIN_PIN){
    document.getElementById("login").style.display="none";
    document.getElementById("content").style.display="block";
    load();
  }else alert("PIN incorreto");
}

function load(){
  let currentTab="pendentes";
function setTab(t){
  currentTab=t;
  document.querySelectorAll(".fbtn").forEach(b=>b.classList.toggle("active", b.dataset.tab===t));
  document.getElementById("hPend").style.display = (t==="pendentes")?"block":"none";
  document.getElementById("tablePend").style.display = (t==="pendentes")?"table":"none";
  document.getElementById("acompSection").style.display = (t==="acomp")?"block":"none";
}
window.addEventListener("click",(e)=>{
  const b=e.target.closest?.(".fbtn");
  if(!b) return;
  setTab(b.dataset.tab);
});

function statusLabel(s){
  if(s==="requested") return "Pendente";
  if(s==="authorized") return "Autorizado";
  if(s==="purchased") return "Comprado";
  if(s==="received") return "Chegou";
  if(s==="rejected") return "Recusado";
  return s||"-";
}

db.ref("purchaseRequests").on("value",snap=>{
  const all=snap.val()||{};
  const tbody=document.getElementById("rows");
  tbody.innerHTML="";
  Object.entries(all).forEach(([id,r])=>{
    if(r.status!=="requested") return;
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${fmt(r.requestedAt)}</td>
      <td>${esc(r.member||"-")}</td>
      <td>${esc(r.cost||"-")}</td>
      <td>${esc(r.item||"-")}</td>
      <td>${esc(r.qty||"")} ${esc(r.unit||"")}</td>
      <td>
        <button class="btn-ok" onclick="authorize('${id}')">Autorizar</button>
        <button class="btn-red" onclick="reject('${id}')">Recusar</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  const tbodyAll=document.getElementById("rowsAll");
  tbodyAll.innerHTML="";
  Object.entries(all).forEach(([id,r])=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${fmt(r.requestedAt)}</td>
      <td>${esc(r.member||"-")}</td>
      <td>${esc(r.cost||"-")}</td>
      <td>${esc(r.item||"-")}</td>
      <td>${esc(r.qty||"")} ${esc(r.unit||"")}</td>
      <td>${statusLabel(r.status)}</td>
    `;
    tbodyAll.appendChild(tr);
  });
});
});
}

function approve(id){
  db.ref("purchaseRequests/"+id).update({
    status:"authorized",
    authorizedAt:Date.now()
  });
}
function reject(id){
  if(confirm("Confirmar recusa?")){
    db.ref("purchaseRequests/"+id).update({
      status:"rejected",
      rejectedAt:Date.now()
    });
  }
}
</script>
</body>
</html>
